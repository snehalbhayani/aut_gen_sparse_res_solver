function [ eqs, data0, eqs_data ] = problem_p45p_fuv_cvpr18( data0 )

integer_instance = 0;
if nargin < 1 || isempty(data0)
    %data0 = randi(50,12*3,1);
    data0 = setup_integer_instance();
    % This problem required consistent input coefficients
    integer_instance = 1;
end


xx = create_vars(2);
N = reshape(data0,12,3);
P = reshape(N*[xx;1],3,4);
A = P(:,1:3);

% Ugly hack to avoid integer overflow
if integer_instance
    A = sym(A);
end

eqs(1) = A(3,1)^2*A(1,2)*A(2,2) - A(2,1)*A(3,1)*A(1,2)*A(3,2) - A(1,1)*A(3,1)*A(2,2)*A(3,2) + A(1,1)*A(2,1)*A(3,2)^2 + A(3,1)^2*A(1,3)*A(2,3) + A(3,2)^2*A(1,3)*A(2,3) - A(2,1)*A(3,1)*A(1,3)*A(3,3) - A(2,2)*A(3,2)*A(1,3)*A(3,3) - A(1,1)*A(3,1)*A(2,3)*A(3,3) - A(1,2)*A(3,2)*A(2,3)*A(3,3) + A(1,1)*A(2,1)*A(3,3)^2 + A(1,2)*A(2,2)*A(3,3)^2;
eqs(2) = A(3,1)^2*A(1,2)^2 - A(3,1)^2*A(2,2)^2 - 2*A(1,1)*A(3,1)*A(1,2)*A(3,2) + 2*A(2,1)*A(3,1)*A(2,2)*A(3,2) + A(1,1)^2*A(3,2)^2 - A(2,1)^2*A(3,2)^2 + A(3,1)^2*A(1,3)^2 + A(3,2)^2*A(1,3)^2 - A(3,1)^2*A(2,3)^2 - A(3,2)^2*A(2,3)^2 - 2*A(1,1)*A(3,1)*A(1,3)*A(3,3) - 2*A(1,2)*A(3,2)*A(1,3)*A(3,3) + 2*A(2,1)*A(3,1)*A(2,3)*A(3,3) + 2*A(2,2)*A(3,2)*A(2,3)*A(3,3) + A(1,1)^2*A(3,3)^2 - A(2,1)^2*A(3,3)^2 + A(1,2)^2*A(3,3)^2 - A(2,2)^2*A(3,3)^2;
eqs(3) = A(3,1)*A(1,2)*A(3,2)^2*A(1,3) - A(1,1)*A(3,2)^3*A(1,3) + A(3,1)*A(2,2)*A(3,2)^2*A(2,3) - A(2,1)*A(3,2)^3*A(2,3) - A(3,1)*A(1,2)^2*A(3,2)*A(3,3) - A(3,1)*A(2,2)^2*A(3,2)*A(3,3) + A(1,1)*A(1,2)*A(3,2)^2*A(3,3) + A(2,1)*A(2,2)*A(3,2)^2*A(3,3) + A(3,1)*A(3,2)*A(1,3)^2*A(3,3) + A(3,1)*A(3,2)*A(2,3)^2*A(3,3) - A(3,1)*A(1,2)*A(1,3)*A(3,3)^2 - A(1,1)*A(3,2)*A(1,3)*A(3,3)^2 - A(3,1)*A(2,2)*A(2,3)*A(3,3)^2 - A(2,1)*A(3,2)*A(2,3)*A(3,3)^2 + A(1,1)*A(1,2)*A(3,3)^3 + A(2,1)*A(2,2)*A(3,3)^3;
eqs(4) = A(3,1)^2*A(1,2)*A(3,2)*A(1,3) - A(1,1)*A(3,1)*A(3,2)^2*A(1,3) + A(3,1)^2*A(2,2)*A(3,2)*A(2,3) - A(2,1)*A(3,1)*A(3,2)^2*A(2,3) - A(3,1)^2*A(2,2)^2*A(3,3) - A(1,1)*A(3,1)*A(1,2)*A(3,2)*A(3,3) + A(2,1)*A(3,1)*A(2,2)*A(3,2)*A(3,3) + A(1,1)^2*A(3,2)^2*A(3,3) + A(3,1)^2*A(1,3)^2*A(3,3) - A(3,2)^2*A(2,3)^2*A(3,3) - 2*A(1,1)*A(3,1)*A(1,3)*A(3,3)^2 + 2*A(2,2)*A(3,2)*A(2,3)*A(3,3)^2 + A(1,1)^2*A(3,3)^3 - A(2,2)^2*A(3,3)^3;
eqs(5) = A(3,1)^3*A(1,2)*A(1,3) - A(1,1)*A(3,1)^2*A(3,2)*A(1,3) + A(3,1)^3*A(2,2)*A(2,3) - A(2,1)*A(3,1)^2*A(3,2)*A(2,3) - A(1,1)*A(3,1)^2*A(1,2)*A(3,3) - A(2,1)*A(3,1)^2*A(2,2)*A(3,3) + A(1,1)^2*A(3,1)*A(3,2)*A(3,3) + A(2,1)^2*A(3,1)*A(3,2)*A(3,3) - A(3,1)*A(3,2)*A(1,3)^2*A(3,3) - A(3,1)*A(3,2)*A(2,3)^2*A(3,3) + A(3,1)*A(1,2)*A(1,3)*A(3,3)^2 + A(1,1)*A(3,2)*A(1,3)*A(3,3)^2 + A(3,1)*A(2,2)*A(2,3)*A(3,3)^2 + A(2,1)*A(3,2)*A(2,3)*A(3,3)^2 - A(1,1)*A(1,2)*A(3,3)^3 - A(2,1)*A(2,2)*A(3,3)^3;
eqs(6) = A(3,1)^2*A(2,2)^2*A(3,2) - 2*A(2,1)*A(3,1)*A(2,2)*A(3,2)^2 + A(2,1)^2*A(3,2)^3 - A(3,1)^2*A(3,2)*A(1,3)^2 - A(3,2)^3*A(1,3)^2 + A(3,1)^2*A(1,2)*A(1,3)*A(3,3) + A(1,1)*A(3,1)*A(3,2)*A(1,3)*A(3,3) + 2*A(1,2)*A(3,2)^2*A(1,3)*A(3,3) + A(3,1)^2*A(2,2)*A(2,3)*A(3,3) - A(2,1)*A(3,1)*A(3,2)*A(2,3)*A(3,3) - A(1,1)*A(3,1)*A(1,2)*A(3,3)^2 - A(2,1)*A(3,1)*A(2,2)*A(3,3)^2 + A(2,1)^2*A(3,2)*A(3,3)^2 - A(1,2)^2*A(3,2)*A(3,3)^2;
eqs(7) = A(3,1)^3*A(2,2)^2 - 2*A(2,1)*A(3,1)^2*A(2,2)*A(3,2) + A(2,1)^2*A(3,1)*A(3,2)^2 - A(3,1)^3*A(1,3)^2 - A(3,1)*A(3,2)^2*A(1,3)^2 + 2*A(1,1)*A(3,1)^2*A(1,3)*A(3,3) + A(3,1)*A(1,2)*A(3,2)*A(1,3)*A(3,3) + A(1,1)*A(3,2)^2*A(1,3)*A(3,3) - A(3,1)*A(2,2)*A(3,2)*A(2,3)*A(3,3) + A(2,1)*A(3,2)^2*A(2,3)*A(3,3) - A(1,1)^2*A(3,1)*A(3,3)^2 + A(3,1)*A(2,2)^2*A(3,3)^2 - A(1,1)*A(1,2)*A(3,2)*A(3,3)^2 - A(2,1)*A(2,2)*A(3,2)*A(3,3)^2;

if integer_instance
    eqs = zp_reduce(eqs,30097);
    eqs = multipol(eqs);
end


if nargout == 3
    xx = create_vars(2+12*3);
    eqs_data = problem_p45p_fuv_cvpr18(xx(3:end));
end


function data0 = setup_integer_instance()
p = 30097;
U = randi(50,3,5);

% % Planar data
% U(3,:) = 0;
% %U = randi(50,3,2)*randi(10,2,5);

u = randi(50,2,5);
% Setup nullspace
M = [];
for k = 1:5
    M = [M; U(:,k)' zeros(1,3) -u(1,k)*U(:,k)' 1 0 -u(1,k)];
    M = [M; zeros(1,3) U(:,k)' -u(2,k)*U(:,k)' 0 1 -u(2,k)];
end
% Reorder such that P = reshape(N*[xx;1],3,4)
ind = [1:3:9 2:3:9 3:3:9 10:12];
M = M(:,ind);

% Throw away one equation
M = M(1:end-1,:);
[~,N] = zp_linsolve(M,zeros(9,1),p);
N = sym(N);
N = N*randi(50,3);
N = mod(N,30097);
N = double(N);
data0 = N(:);

